# .env5 â€” NZ Salon Finder Backend (advanced)

# ----------------------------
# App
# ----------------------------
APP_NAME="Saloon AI Agent"
ENVIRONMENT="dev"
ALLOWED_ORIGINS="http://localhost:3000"

# ----------------------------
# Database
# ----------------------------
# SQLite (dev)
DATABASE_URL="sqlite:///./app.db"
# Example Postgres (prod)
# DATABASE_URL="postgresql+psycopg://user:password@host:5432/dbname"

# ----------------------------
# Supabase (server-side only)
# ----------------------------
SUPABASE_URL="https://tkhodkvmkpnyyacetzgh.supabase.co"
SUPABASE_SERVICE_ROLE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRraG9ka3Zta3BueXlhY2V0emdoIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2OTQzNzc1MSwiZXhwIjoyMDg1MDEzNzUxfQ.5Lj-2fk1-zZgaoCU49GmF1-l8sIzBcRS94hJRj0NBks"
SUPABASE_JWT_SECRET="sb_secret_KS46cI-EC8NVECBdvAI7VA_6anui8bC"
# Optional but recommended issuer check:
# SUPABASE_JWT_ISSUER="https://YOUR_PROJECT.supabase.co/auth/v1"
SUPABASE_JWT_ISSUER="tkhodkvmkpnyyacetzgh"
SUPABASE_PROFILES_TABLE="profiles"

# ----------------------------
# SerpApi
# ----------------------------
SERPAPI_API_KEY="dc68d09b5c9a0a6220ab61266bbd0e8780f2c51bf92f3a04945746564c500d84"
# Choose engine: "google_maps" is best for local business results
SERPAPI_ENGINE="google_maps"
# NZ localization
SERPAPI_GL="nz"
SERPAPI_HL="en"
# Optional: location string override format (if you don't have lat/lng)
# SERPAPI_LOCATION="Auckland, New Zealand"

# ----------------------------
# Stripe (Booking fee)
# ----------------------------
STRIPE_SECRET_KEY="sk_test_51SfCF2RvOD9QqeiFnQjB3YqS3Rx3m7nqIRy5MpVrqyf22B0coVnqgLsgTR52LHp3kPlMefZ1O5lxunRaBpLKvXEM006xxVVCsi"
STRIPE_WEBHOOK_SECRET="whsec_8lnu9Wk0XrzbD6zi8ePI3RePTKBKmR3v"
# Where Stripe redirects user after checkout:
STRIPE_SUCCESS_URL="http://localhost:5173/booking/success?session_id={CHECKOUT_SESSION_ID}"
STRIPE_CANCEL_URL="http://localhost:5173/dashboard"

# Booking fee configuration:
# Recommended: Use Stripe Price ID (pre-created in Stripe dashboard)
STRIPE_BOOKING_FEE_PRICE_ID="price_123"
# Alternatively you can use amount/currency (disabled in code by default)
STRIPE_CURRENCY="nzd"

# ----------------------------
# Safe Fetch (SSRF hardened)
# ----------------------------
SAFE_FETCH_USER_AGENT="SalonAgentBot/2.0 (+https://yourdomain.example)"
SAFE_FETCH_TIMEOUT_S=8.0
SAFE_FETCH_MAX_BYTES=900000
SAFE_FETCH_ALLOW_PRIVATE_IPS=false
SAFE_FETCH_ALLOWED_PORTS="80,443"
SAFE_FETCH_MAX_REDIRECTS=5

# ----------------------------
# Booking link extraction limits
# ----------------------------
BOOKING_SCAN_MAX_LINKS=300
BOOKING_SCAN_MAX_ANCHORS=1200
BOOKING_ONE_HOP_INTERNAL_CRAWL=true
BOOKING_WELL_KNOWN_PATHS="/book,/booking,/appointments,/appointment,/contact,/services"

# ----------------------------
# Search limits
# ----------------------------
DEFAULT_RADIUS_M=6000
MAX_RADIUS_M=30000
DEFAULT_LIMIT=10
MAX_LIMIT=30

# ----------------------------
# Rate limiting + bans
# ----------------------------
RL_IP_RPS=1.2
RL_USER_RPS=1.2
RL_BURST=8
BAN_WINDOW_S=600
BAN_THRESHOLD=5
BAN_THRESHOLD_HARD=10
BAN_KIND_WEIGHTS="ssrf_block=3,invalid_url=2,ratelimit=1,fetch_fail=1"

# ----------------------------
# Tool budgets (cost tokens)
# ----------------------------
BUDGET_TOKENS_PER_REQUEST=55
COST_GOOGLE_NEARBY=6
COST_GOOGLE_DETAILS=2
COST_WEB_FETCH=5
COST_WEB_FETCH_ONE_HOP=4
MAX_DETAILS_CALLS=20
MAX_WEBSITE_FETCHES=12

# ----------------------------
# Cache TTLs
# ----------------------------
IDEM_TTL_S=240
PLACES_CACHE_TTL_S=600
DETAILS_CACHE_TTL_S=86400

# ----------------------------
# Reputation lists
# ----------------------------
DOMAIN_DENYLIST="bit.ly,tinyurl.com,goo.gl,ow.ly"
PROVIDER_DOMAINS="timelyapp.com,timely.nz,fresha.com,square.site,squareup.com,booksy.com"